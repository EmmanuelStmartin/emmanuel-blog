<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,500;1,400;1,500&display=swap"
      rel="stylesheet"
    />
    {{if hasmath}} {{insert head_katex.html }} {{end}} 
    {{if hascode}} {{insert head_highlight.html }} {{end}} 
    {{insert style.html}}
    {{isdef title}}<title>{{fill title}}</title>{{end}}
  </head>
  <body>
    <div class="center-column-holder">
      <div class="center-column">
        {{insert header.html}}
        <!-- Content will be injected here by Franklin -->
        <button id="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
      </div>
    </div>

    <style>
      /* Theme toggle styling */
      #theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem;
        font-size: 1.25rem;
        border: none;
        background: none;
        cursor: pointer;
        z-index: 1000;
      }

      /* Theme variables */
      :root {
        --background: #ffffff;
        --text-color: #000000;
        --transition-speed: 0.3s;
      }

      body.dark-theme {
        --background: #1a1a1a;
        --text-color: #ffffff;
      }

      body {
        background-color: var(--background);
        color: var(--text-color);
        transition: background-color var(--transition-speed), 
                    color var(--transition-speed);
      }
    </style>

    <!-- Franklin's required scripts -->
    {{insert foot.html}}
    
    <!-- Theme toggle script -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const themeToggle = document.getElementById('theme-toggle');
        const storedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        function applyTheme(isDark) {
            document.body.classList.toggle('dark-theme', isDark);
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        themeToggle.addEventListener('click', () => {
            const isDark = !document.body.classList.contains('dark-theme');
            applyTheme(isDark);
        });

        // Initial load
        if (storedTheme) {
            applyTheme(storedTheme === 'dark');
        } else {
            applyTheme(systemDark);
        }

        // System theme listener
        window.matchMedia('(prefers-color-scheme: dark)')
            .addEventListener('change', e => {
                if (!localStorage.getItem('theme')) {
                    applyTheme(e.matches);
                }
            });
    });
    </script>
  </body>
</html>
